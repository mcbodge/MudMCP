# Template: Deploy IIS
# NOTE: Inline scripts were moved to eng/scripts for easier review and CODEOWNERS protection.

parameters:
  - name: siteName
    type: string
    default: 'Default Web Site'
  - name: appPoolName
    type: string
    default: 'DefaultAppPool'
  - name: physicalPath
    type: string
    default: '$(System.DefaultWorkingDirectory)'
  - name: artifactPath
    type: string
    default: ''
  - name: environmentName
    type: string
    default: ''

steps:
  # Stop IIS site + app pool (best-effort)
  - task: PowerShell@2
    displayName: 'Stop IIS site and app pool'
    inputs:
      targetType: 'filePath'
      filePath: '$(System.DefaultWorkingDirectory)/eng/scripts/Stop-IisSiteAndAppPool.ps1'
      arguments: >
        -SiteName "${{ parameters.siteName }}"
        -AppPoolName "${{ parameters.appPoolName }}"
      pwsh: true

  # Deploy content
  - task: PowerShell@2
    displayName: 'Deploy content to IIS physical path'
    inputs:
      targetType: 'filePath'
      filePath: '$(System.DefaultWorkingDirectory)/eng/scripts/Deploy-IisContent.ps1'
      arguments: >
        -PhysicalPath "${{ parameters.physicalPath }}"
        -ArtifactPath "${{ parameters.artifactPath }}"
      pwsh: true

  # Start IIS site + app pool
  - task: PowerShell@2
    displayName: 'Start IIS site and app pool'
    inputs:
      targetType: 'filePath'
      filePath: '$(System.DefaultWorkingDirectory)/eng/scripts/Start-IisSiteAndAppPool.ps1'
      arguments: >
        -SiteName "${{ parameters.siteName }}"
        -AppPoolName "${{ parameters.appPoolName }}"
      pwsh: true
